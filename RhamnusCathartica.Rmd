---
title: "GeorefRham"
author: "Laura Kostyniuk"
date: "04/08/2020"
output: html_document
---

# **Rhamnus cathartica: Georeferencing and Making Species Distribution Models**

This project's goal is to convert the spreadsheet data of georeferenced locations of instances of R. cathartica into maps projections and models that can overlay climate data, or separate the data into different subcategories.

R. cathartica (common buckthorn) is native to Europe, parts of Asia, and parts of Africa. It is naturalized in North America, and considered an invasive species in some US states and Ontario, Canada. 

##GBIF Data Cleansing

The original data that was used in these models is from GBIF. The following steps were applied to the spreadsheets downloaded from GBIF to organize and complete the data:
- re-organize records by country code, province, and locality alphabetically.  
- search and remove existing latitude/longitude coordinates that did not make sense (0,0 coordinates, coordinates that were duplicated in multiple records with different localities).  
- Add missing province information to records that contained clear locality information and/or coordinates already.  
- Manually pass through data: reading, interpreting, and finding the localities described. Once found, the coordinates and uncertainty were obtained using Google Maps and inputted into the spreadsheet.  
- *NOTE: not all localities were possible to identify. In these cases, no coordinates or uncertainty were added to the spreadsheet, and LocationNotFound keyword was added to the record.*  

##Data formatting and Model Construction

The cleansed data from GBIF was downloaded as a .tsv file and formatted properly for model construction in R studio. The following steps were applied to the data in this Rmd file.
- Download necessary R packages before they will be needed.  
- Import data from Google sheets.  
- Refine data format for use in R studio.  
- Create a local copy of refined dataset.  
- Plot data on scatterplot to see general shape (checking that data makes sense).  
- Plot data on a basic map projection.  
- Create subsets of data; by country, decade, etc.  
- Colour code points on map by subsets created.  

- Create climate data maps  
- Add uncertainty to points  
```{r}
# packages required to install to run this Rmd file
install.packages(c("googlesheets4", 
                   "raster", 
                   "rgdal", 
                   "dismo", 
                   "rJava", 
                   "maptools", 
                   "rgeos", 
                   "scales"))
```

```{r}
library(googlesheets4) # loading package

Rham <- read_sheet("https://docs.google.com/spreadsheets/d/1JCgvTShYHXt2PfiDQowLeX9m3N7h_2r8mqTk6vS6_tU/edit?usp=sharing") # read data
```

```{r}
Rham <- Rham[, ! colnames(Rham) %in% c("occurrenceID", "georeferencedDate",
                                       "catalogNumber", "recordNumber")] # removing funky columns
write.table(x = Rham, file = "Rham.tsv") # storing local copy of file from google sheets to prevent having to re-authenticate
Rham <- read.table("Rham.tsv") # data preview
```

Plotting out all the data we will be working with:

```{r}
plot(x = Rham$decimalLongitude, y = Rham$decimalLatitude, xlab = "Longitude", ylab = "Latitude", cex=0.5)

```
Plotting the data we will be working with on a map projection:
```{r}
library(scales)
library(rgeos)
library(maptools)
data(wrld_simpl)
plot(wrld_simpl)
box()
points(Rham$decimalLongitude, Rham$decimalLatitude, col=alpha("red", 0.5), pch=16, cex=0.25)
```
```{r}
summary(Rham) # important information: min year = 1600, max year = 2019
              # important information: min precision = 1, max precision = 4000000
```

```{r}
# creating useful objects 
withDate <- subset(Rham, year >= 1600 & year <= 2019)
withPrec <- subset(Rham, coordinateUncertaintyInMeters >= 1 & coordinateUncertaintyInMeters <= 4000000)
```

```{r}
# subsetting US records by date and mapping them on a US map
usa <- subset(Rham, countryCode == "US")
#used summary(usa) to determine earliest record is from 1844, 
#latest record is from 2018
#logical separation is every 10 years: 1840 to 2020, 18 decades/divisions
us1 <- subset(usa, year >=1840 & year <=1849)
us2 <- subset(usa, year >=1850 & year <=1859)
us3 <- subset(usa, year >=1860 & year <=1869)
us4 <- subset(usa, year >=1870 & year <=1879)
us5 <- subset(usa, year >=1880 & year <=1889)
us6 <- subset(usa, year >=1890 & year <=1899)
us7 <- subset(usa, year >=1900 & year <=1909)
us8 <- subset(usa, year >=1910 & year <=1919)
us9 <- subset(usa, year >=1920 & year <=1929)
us10 <- subset(usa, year >=1930 & year <=1939)
us11 <- subset(usa, year >=1940 & year <=1949)
us12 <- subset(usa, year >=1950 & year <=1959)
us13 <- subset(usa, year >=1960 & year <=1969)
us14 <- subset(usa, year >=1970 & year <=1979)
us15 <- subset(usa, year >=1980 & year <=1989)
us16 <- subset(usa, year >=1990 & year <=1999)
us17 <- subset(usa, year >=2000 & year <=2009)
us18 <- subset(usa, year >=2010 & year <=2019)
library(scales)
library(rgeos)
library(maptools)
data(wrld_simpl)
plot(wrld_simpl, xlim=c(-127, -63), ylim=c(20, 50))
box()
points(x=us1$decimalLongitude, y=us1$decimalLatitude, col=alpha("#F71B18", 0.75), pch=16, cex=0.25)
points(x=us2$decimalLongitude, y=us2$decimalLatitude, col=alpha("#F74D18", 0.5), pch=16, cex=0.25)
points(x=us3$decimalLongitude, y=us3$decimalLatitude, col=alpha("#F77F18", 0.75), pch=16, cex=0.25)
points(x=us4$decimalLongitude, y=us4$decimalLatitude, col=alpha("#F7B218", 0.75), pch=16, cex=0.25)
points(x=us5$decimalLongitude, y=us5$decimalLatitude, col=alpha("#F7E419", 0.75), pch=16, cex=0.25)
points(x=us6$decimalLongitude, y=us6$decimalLatitude, col=alpha("#D7F719", 0.75), pch=16, cex=0.25)
points(x=us7$decimalLongitude, y=us7$decimalLatitude, col=alpha("#A5F719", 0.75), pch=16, cex=0.25)
points(x=us8$decimalLongitude, y=us8$decimalLatitude, col=alpha("#74F71A", 0.75), pch=16, cex=0.25)
points(x=us9$decimalLongitude, y=us9$decimalLatitude, col=alpha("#42F71A", 0.75), pch=16, cex=0.25)
points(x=us10$decimalLongitude, y=us10$decimalLatitude, col=alpha("#1AF724", 0.75), pch=16, cex=0.25)
points(x=us11$decimalLongitude, y=us11$decimalLatitude, col=alpha("#1AF756", 0.75), pch=16, cex=0.25)
points(x=us12$decimalLongitude, y=us12$decimalLatitude, col=alpha("#1BF788", 0.75), pch=16, cex=0.25)
points(x=us13$decimalLongitude, y=us13$decimalLatitude, col=alpha("#1BF7B9", 0.75), pch=16, cex=0.25)
points(x=us14$decimalLongitude, y=us14$decimalLatitude, col=alpha("#1BF7EB", 0.75), pch=16, cex=0.25)
points(x=us15$decimalLongitude, y=us15$decimalLatitude, col=alpha("#1CD1F7", 0.75), pch=16, cex=0.25)
points(x=us16$decimalLongitude, y=us16$decimalLatitude, col=alpha("#1CA0F7", 0.75), pch=16, cex=0.25)
points(x=us17$decimalLongitude, y=us17$decimalLatitude, col=alpha("#1C6EF7", 0.75), pch=16, cex=0.25)
points(x=us18$decimalLongitude, y=us18$decimalLatitude, col=alpha("#1D3DF7", 0.75), pch=16, cex=0.25)
#hex codes for colours and gradient was created using http://www.perbang.dk/rgbgradient/
```
```{r}
cad <- subset(Rham, countryCode == "CA")
# used summary(cad)to determine oldest record is from 1894, youngest record is from 2019
#will divide into 13 decades from 1890 to 2020
ca1 <- subset(cad, year >=1890 & year <=1899)
ca2 <- subset(cad, year >=1900 & year <=1909)
ca3 <- subset(cad, year >=1910 & year <=1919)
ca4 <- subset(cad, year >=1920 & year <=1929)
ca5 <- subset(cad, year >=1930 & year <=1939)
ca6 <- subset(cad, year >=1940 & year <=1949)
ca7 <- subset(cad, year >=1950 & year <=1959)
ca8 <- subset(cad, year >=1960 & year <=1969)
ca9 <- subset(cad, year >=1970 & year <=1979)
ca10 <- subset(cad, year >=1980 & year <=1989)
ca11 <- subset(cad, year >=1990 & year <=1999)
ca12 <- subset(cad, year >=2000 & year <=2009)
ca13 <- subset(cad, year >=2010 & year <=2019)
library(scales)
library(rgeos)
library(maptools)
data(wrld_simpl)
plot(wrld_simpl, xlim=c(-145, -50), ylim=c(40, 80))
box()
points(x=ca1$decimalLongitude, y=ca1$decimalLatitude, col=alpha("#28EB2F", 0.75), pch=16, cex=0.5)
points(x=ca2$decimalLongitude, y=ca2$decimalLatitude, col=alpha("#55EA27", 0.5), pch=16, cex=0.5)
points(x=ca3$decimalLongitude, y=ca3$decimalLatitude, col=alpha("#8AEA27", 0.75), pch=16, cex=0.5)
points(x=ca4$decimalLongitude, y=ca4$decimalLatitude, col=alpha("#BFEA27", 0.75), pch=16, cex=0.5)
points(x=ca5$decimalLongitude, y=ca5$decimalLatitude, col=alpha("#EADF27", 0.75), pch=16, cex=0.5)
points(x=ca6$decimalLongitude, y=ca6$decimalLatitude, col=alpha("#E9A927", 0.75), pch=16, cex=0.5)
points(x=ca7$decimalLongitude, y=ca7$decimalLatitude, col=alpha("#E97426", 0.75), pch=16, cex=0.5)
points(x=ca8$decimalLongitude, y=ca8$decimalLatitude, col=alpha("#E93E26", 0.75), pch=16, cex=0.5)
points(x=ca9$decimalLongitude, y=ca9$decimalLatitude, col=alpha("#E92644", 0.75), pch=16, cex=0.5)
points(x=ca10$decimalLongitude, y=ca10$decimalLatitude, col=alpha("#E82679", 0.75), pch=16, cex=0.5)
points(x=ca11$decimalLongitude, y=ca11$decimalLatitude, col=alpha("#E826AE", 0.75), pch=16, cex=0.5)
points(x=ca12$decimalLongitude, y=ca12$decimalLatitude, col=alpha("#E826E3", 0.75), pch=16, cex=0.5)
points(x=ca13$decimalLongitude, y=ca13$decimalLatitude, col=alpha("#B826E8", 0.75), pch=16, cex=0.5)
#hex codes for colours and gradient was created using http://www.perbang.dk/rgbgradient/
```

Visualizing when the occurrences of R. cathartica are noted during the year (by month):
```{r}
hist(Rham$month, breaks = 12, xlab="Month")
```
Comparing the worldwide frequency of ocurrence per month to the Canadian ocurrence per month:
```{r}
hist(cad$month, breaks = 12, xlab="Month")
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
